<script lang="ts">
	import dayjs from "dayjs";
	import { page } from "$app/stores";
	import { Link } from "./ui/link";

	const now = dayjs();
	const year = now.year();

	const isPrideMonth = now.isBetween(`${year}-06-01`, `${year}-06-30`);
</script>

<header class="fixed z-10 w-full border-b border-b-white/10 px-8 backdrop-blur md:px-14">
	<div class="flex h-[var(--header-height)] items-center justify-between">
		<div class="flex items-center gap-x-3">
			<a class="flex items-center gap-x-3" href="/">
				{#if isPrideMonth}
					{@render logo("/favicon-pride.png", "shadow dark:shadow-none")}
				{:else}
					{@render logo("/favicon.svg", "invert dark:invert-0")}
				{/if}

				<h1 class="text-xl font-semibold">The First Knife</h1>
			</a>
		</div>

		<!-- TODO: styling -->
		<div class="flex items-center gap-x-4 text-sm">
			{#if $page.data.user}
				{@const [username, discriminator] = $page.data.user.bungieName.split("#")}

				<form method="post" action="/?/signOut">
					<button class="inline-flex">
						{username}
						<span class="text-[#01d9f8]">#{discriminator}</span>
					</button>
				</form>
			{:else}
				<Link class="interactable px-3 py-1.5 no-underline" href="/auth">
					<svg
						class="mr-2 size-4"
						xmlns="http://www.w3.org/2000/svg"
						width="32"
						height="32"
						viewBox="0 0 24 24"
					>
						<path
							fill="currentColor"
							d="m23.864 12.77l-1.1-.818V.465l-10.36.5l-10.36-.5v2.932L.431 2.756a.316.316 0 0 0-.275.566l1.888 1.166v7.538c.015 3.239 2.459 5.981 4.868 7.968a29.8 29.8 0 0 0 5.507 3.541l.4-.219c.2-.1 2.653-1.336 5.075-3.323c2.193-1.806 4.4-4.241 4.795-7.102l.86.423c.193.097.462-.05.45-.298c-.006-.169-.135-.244-.135-.246M2.408.848l9.996.481L22.4.847V11.68l-.492-.365l.004-.361v-9.65l-9.504.462l-9.503-.463V3.74l-.497-.197Zm15.922 2.94v-.446h1.638l-.953 2.256h-.529l.784-1.81zm-6.473 4.76a.8.8 0 0 1 .371.341l.596 1.089l1.936 1.28c-.172.31-.233.557-.265.655l-.02.072l.278 1.465c-.014.005-.027.006-.041.011c-.404.134-.765.361-1.135.566c-.255.143-.305.17-.433.215a1.23 1.23 0 0 1-.82.017l-.086-.023c-.234-.043-.584-.344-.866-.586c-.392-.335-.517-.434-.81-.566l-.042-.02l.448-1.571l-1.779-2.9a.143.143 0 0 1 .013-.189l1.21-2.253a.143.143 0 0 1 .197-.043c.836.34 1.658.713 2.481 1.082a.14.14 0 0 1 .074.187l-.544.868a.14.14 0 0 1-.183.08l-1.243-.498l-.187.308c-.003.001.193.078.85.412m6.77 6.973c.056.16-.14.345-.181.49c-.018.06-.009.14-.03.202c-.089.25-.288.468-.417.697a.3.3 0 0 1-.1-.03c-.134-.073.304-.583.339-.644c.084-.143-.728-.143-.775-.167c-.17-.083-.296-.3-.361-.47c-.067-.174-.122-.495.103-.575c.098-.038.211.016.317-.022c.083-.03.154-.127.207-.187c-.238-.191-.46-.26-.68-.26c-.379 0-.748.205-1.173.353c-.289.055-.556.098-.676.123c-.508.103-1.015.54-1.416.673a3.1 3.1 0 0 1-1.197.187c-.58-.045-.958-.05-1.827-.783c-.452-.357-.568-.615-1.745-.862c-.52-.104-.995-.226-.967-.516c.008-.183.318-.356.237-.54c-.042-.096-.084-.328-.013-.48c-.149-.282-.286-.344-.689-.47a1.4 1.4 0 0 0-.45-.067c.016.08.02.166.005.246c-.036.196-.131.696-.516.632c-.016-.045.166-.254-.125-.596c-.175-.202-.53-.778-.146-1.053c.433-.303.99-.101 1.322.073c.103.089.877.181 1.235.256c.425.084.749.477.45.773c-.193.16-.503.378-.353.448c.103.023.501.116.577.137c.23.062.491.142.717.232c.009.003.236.097.358.176c.437.28 1.03.965 1.52 1.056c.084.019.28.09.547.09c.393 0 .733-.181.83-.238l.192-.105c.368-.207.71-.415 1.066-.534a1.8 1.8 0 0 1 .518-.1c.25-.028.49-.042.566-.066c.374-.118.757-.253 1.148-.253c.526 0 .886.245 1.157.61c.078.104.46.641.356.774c-.116.15-.37.31-.402.512c-.03.204.07.203.198.19s.235-.022.273.088m-4.546 2.89c.048.002.03.067.063.052s.06-.02.08.033c.025.07-.065.041-.042.071c.03.04-.074.184-.139.215c-.065.03-.062-.05-.11-.05c-.05-.002-.034.03-.057-.011s-.006-.072.02-.095c.024-.023-.005-.065-.005-.065l-.12-.375l-.998.811l1.004.891s.164.344.083.34c-.201-.007-.337-.036-.337-.036l-1.11-.902l-1.11.902s-.136.029-.336.036c-.083.003.082-.34.082-.34l1.004-.89l-.999-.812l-.119.375s-.029.042-.004.065c.026.024.042.055.02.095s-.008.009-.057.01c-.048 0-.046.08-.11.051c-.066-.03-.17-.175-.14-.215c.024-.03-.066 0-.042-.071c.02-.054.046-.049.08-.033c.033.015.014-.049.063-.051c.07-.002.099-.523.099-.523l-.617-.545l-.091-.107s-.097.019-.162-.043c-.067-.062-.087-.236-.02-.315c.061-.074.194-.088.308.023c.065.062.053.132.053.132l.111.094l.652.495s.518-.175.513-.223s.061-.038.043-.068c-.02-.03-.029-.058.024-.083c.067-.033.048.06.076.033c.036-.035.195.047.234.108c.037.06-.043.067-.039.116c.005.047.036.029-.002.056c-.038.028-.072.014-.098-.008c-.037-.03-.017-.044-.017-.044l-.406.272l1.006.894l1.007-.894l-.406-.272s.02.015-.017.044c-.026.022-.06.035-.098.008s-.007-.01-.002-.056c.004-.049-.076-.056-.039-.116c.04-.06.198-.143.234-.108c.027.027.01-.067.076-.033c.053.025.045.053.024.083c-.018.03.047.02.043.068s.513.223.513.223l.652-.495l.111-.094s-.013-.07.052-.132c.114-.11.247-.097.309-.023c.066.08.046.253-.02.315c-.067.062-.163.043-.163.043l-.09.107l-.617.545s.034.523.1.523M12.089 6.46l-1.276-.545l.772-1.3a.144.144 0 0 1 .194-.05l.947.56a.14.14 0 0 1 .051.193zm.937-.984a.143.143 0 0 1 .195-.047l.865.513a.14.14 0 0 1 .047.193l-.688 1.105a.4.4 0 0 0-.164-.225a.4.4 0 0 0-.098-.06l-.838-.375Zm1.276.872a.143.143 0 0 1 .196-.046l.778.459a.14.14 0 0 1 .046.193c-.898 1.43-1.044 1.667-1.298 2.074q-.01.016-.017.033a.14.14 0 0 1-.19.04l-.778-.46c-.107-.064-.053-.193-.045-.193c.005 0 .465-.74 1.308-2.1m1.148.889a.146.146 0 0 1 .197-.047l.616.368a.14.14 0 0 1 .047.194L15.1 9.678a.144.144 0 0 1-.195.047l-.618-.369a.14.14 0 0 1-.046-.193zM.287 3.102c-.054-.032-.033-.126.05-.107l6.887 2.738l-.13-2.405l3.49 2.47s-.04-.016-.1-.016c-.115 0-.205.06-.229.117l-.708 1.318l-.888-.62l-.375 1.446Zm17.376 16.611a29.4 29.4 0 0 1-5.012 3.282l-.24.13l-.247-.126c-.211-.104-2.64-1.332-5.02-3.286c-2.386-1.96-4.734-4.645-4.736-7.687V4.714l.497.308v7.007c0 5.8 8.927 10.346 9.307 10.537l.205.104l.19-.104c.369-.186 8.82-4.496 9.278-10.07q.23.112.457.225c-.323 2.754-2.476 5.184-4.68 6.992m6.024-6.624h-.002l-.022-.004l-5.538-2.728l-.38 2.556l-4.652-3.11l-.637-1.174l2.039 1.152l.276.165a.5.5 0 0 0 .217.06c.212 0 .329-.192.33-.192l.147-.236l.142-.21l1.074.887l.341-2.252l6.693 4.977c.05.033.028.108-.029.11z"
						/>
					</svg>

					Sign in
				</Link>
			{/if}
		</div>
	</div>
</header>

{#snippet logo(src: string, className?: string)}
	<img class="size-8 rounded {className}" {src} alt="The First Knife" width="128" height="128" />
{/snippet}
